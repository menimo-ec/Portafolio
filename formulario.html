<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario ‚Äì Menimo</title>

    <link rel="stylesheet" href="css/estilos.css">
    <link rel="stylesheet" href="css/formulario.css">
</head>

<body class="fade-in">

<!-- NAV -->
<nav class="nav">
    <a href="index.html"><img src="img/Logo.svg" class="logo"></a>
    <label for="menu-toggle" class="menu-btn">‚ò∞</label>
    <input type="checkbox" id="menu-toggle">
    <ul class="nav-links">
        <li><a href="index.html">Inicio</a></li>
        <li><a href="acerca.html">Sobre mi</a></li>
        <li><a href="servicios.html">Servicios</a></li>
        <li><a href="proyectos.html">Proyectos</a></li>
        <li><a href="contacto.html">Contacto</a></li>
    </ul>
</nav>

<section class="form-container">

    <h1 class="titulo">Formulario</h1>
    <p class="sub">Completa tus datos y cu√©ntame sobre tu proyecto</p>

    <form id="formulario" class="form-card" autocomplete="on">

        <!-- NOMBRE -->
        <label>Nombre completo</label>
        <input type="text" name="nombre" placeholder="Ej. Fernanda Olgu√≠n" required minlength="3">

        <!-- EMAIL -->
        <label>Correo electr√≥nico</label>
        <input type="email" name="email" placeholder="Ej. correo@ejemplo.com" required>

        <!-- FECHA -->
        <label>Fecha estimada de tu proyecto</label>
        <input type="date" name="fecha" required>

        <!-- RANGE -->
        <label>Presupuesto aproximado:</label>
        <span class="range-value" id="rangeText">$10,000</span>
        <input type="range" name="presupuesto" min="0" max="20000" step="500" value="10000" id="rangeInput">

        <!-- MENSAJE -->
        <label>Descripci√≥n del proyecto</label>
        <textarea name="mensaje" required placeholder="Cu√©ntame qu√© necesitas"></textarea>

        <!-- CHECKBOX -->
        <label class="check-label">
        <input type="checkbox" name="terminos" required>Acepto t√©rminos y condiciones</label>

        <!-- BOT√ìN -->
        <button type="submit" class="btn-submit">Enviar</button>

    </form>

</section>

<script src="js/transitions.js"></script>
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script>
emailjs.init("cb9YPzyRWryu9aUy9"); // ‚Üê Public Key correcta

// RANGE - actualizar texto
const rangeInput = document.getElementById("rangeInput");
const rangeText = document.getElementById("rangeText");
rangeInput.addEventListener("input", () => {
    rangeText.textContent = `$${Number(rangeInput.value).toLocaleString()}`;
});

// FORMULARIO
document.getElementById("formulario").addEventListener("submit", async function(e) {
    e.preventDefault();

    const form = document.getElementById("formulario");
    const formData = new FormData(form);

    // Convertir archivo a Base64 SOLO COMO TEXTO (no attachment)
    let archivoBase64 = "No adjunt√≥ archivo";

    const archivo = formData.get("archivo");

    if (archivo && archivo.size > 0) {
        try {
            archivoBase64 = await convertirArchivoBase64(archivo);

            // üî• CAMBIO CLAVE:
            // EmailJS no acepta "data:<mime>;base64," si no tienes PRO.
            // Se limpia el encabezado para enviarlo como texto puro.
            archivoBase64 = archivoBase64.replace(/^data:.*;base64,/, "");
        } catch (err) {
            console.error("Error al convertir archivo:", err);
            archivoBase64 = "Error al convertir archivo (enviado solo como texto)";
        }
    }

    // Datos a enviar a EmailJS
    const params = {
        nombre: formData.get("nombre"),
        email: formData.get("email"),
        fecha: formData.get("fecha"),
        presupuesto: `$${Number(formData.get("presupuesto")).toLocaleString()}`,
        mensaje: formData.get("mensaje"),
        terminos: formData.get("terminos") ? "S√≠" : "No",

        // Aqu√≠ solo se manda texto. Nada de objetos, archivos reales o adjuntos.
        archivo: archivoBase64
    };

    // CAMBIA ESTE "service_xxx" POR TU SERVICE REAL DE EMAILJS
    emailjs.send("service_o5jh9ia", "template_psas0wm", params)
    .then(() => {
        alert("¬°Tu mensaje ha sido enviado con √©xito! Te responder√© pronto üíú");
        form.reset();
        rangeText.textContent = "$0";
    })
    .catch((error) => {
        console.error("Error:", error);
        alert("Hubo un problema al enviar tu formulario. Intenta nuevamente.");
    });
});

// Funci√≥n para convertir archivo a Base64
function convertirArchivoBase64(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(file);
    });
}
</script>

</body>
</html>